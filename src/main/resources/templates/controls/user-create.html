<!DOCTYPE html>
<html th:replace="~{layout/controls :: layout(_,~{},~{::scripts},~{::content},~{})}">

<content>
	<div class="col-md-12 py-3 my-3 mx-auto p-5 rounded box-shadow bg-light">
		<h4 class="mb-3 text-center text-muted">[[#{label.new.user}]]</h4>
		<form action="#" th:action="@{/controls/users/add}" th:object="${selected}" method="POST"
			class="needs-validation" novalidate>
			<div th:if="${success}" class="alert alert-warning" th:text="${success}"></div>

			<div class="row mb-3">
				<label class="col-md-2 col-form-label" th:text="#{label.username}"></label>
				<div class="col-md-6">
					<input class="form-control form-control-sm" th:field="*{username}" required />
					<small class="text-danger" th:if="${#fields.hasErrors('username')}"
						th:errors="*{username}">error</small>
				</div>
			</div>
			<div class="row mb-3">
				<label class="col-md-2 col-form-label" th:text="#{label.password}"></label>
				<div class="col-md-6">
					<input id="user_password" type="password" class="form-control form-control-sm" onChange="onChange()"
						th:field="*{password}" required />
				</div>
			</div>
			<div class="row mb-3">
				<label class="col-md-2 col-form-label" th:text="#{label.confirm.password}"></label>
				<div class="col-md-6">
					<input id="confirm_password" type="password" class="form-control form-control-sm"
						onChange="onChange()" required />
					<div class="invalid-feedback" th:text="#{password.mismatch}"></div>
				</div>
			</div>
			<div class="row mb-3">
				<label class="col-md-2 col-form-label" th:text="#{label.userfullname}"></label>
				<div class="col-md-8">
					<input class="form-control form-control-sm" th:field="*{userfullname}" required />
				</div>
			</div>
			<div class="row mb-3">
				<label class="col-md-2 col-form-label" th:utext="#{label.useremail}"></label>
				<div class="col-md-6">
					<input type="email" class="form-control form-control-sm" th:field="*{useremail}" required />
					<label class="form-label text-danger mt-2"> <input type="checkbox" th:field="*{alerted}" />
						[[#{label.alerted.note}]]
					</label>
					<small class="text-danger" th:if="${#fields.hasErrors('useremail')}"
						th:errors="*{useremail}">error</small>
				</div>
			</div>
			<div class="row mb-3">
				<label class="col-md-2 col-form-label" th:text="#{label.usercontact}"></label>
				<div class="col-auto">
					<input type="text" maxlength="20" class="form-control form-control-sm" th:field="*{usercontact}"
						required />
				</div>
			</div>
			<div class="row mb-3">
				<label class="col-md-2 col-form-label" th:text="#{label.groups}"></label>
				<div class="col-md-8">
					<div class="row">
						<div class="col-md-12" th:each="option : ${user_groups}">
							<label class="form-label fw-bold"> <input type="checkbox" th:field="*{groups}"
									th:value="${option}" />
								[[${option.group_desc}]]
							</label>
						</div>
					</div>
				</div>
			</div>

			<div class="row mb-3">
				<label class="col-md-2 col-form-label" th:text="#{label.userenabled}"></label>
				<div class="col-md-8">
					<div class="custom-control custom-radio">
						<input id="login_disabled" name="login_status_check" type="radio" class="custom-control-input"
							required value="0" th:field="*{enabled}" /> <label
							class="custom-control-label text-secondary" for="login_disabled">Disabled</label>
					</div>
					<div class="custom-control custom-radio">
						<input id="login_enabled" name="login_status_check" type="radio" class="custom-control-input"
							required value="1" th:field="*{enabled}" /> <label class="custom-control-label text-success"
							for="login_enabled">Enabled</label>
					</div>
				</div>
			</div>
			<hr />
			<div class="row mb-3">
				<label class="col-md-2 col-form-label" th:text="#{label.facilities}"></label>
				<div class="col-md-8">
					<div class="row">
						<div class="col-md-12" th:each="option : ${user_facilities}">
							<label class="form-label fw-bold"> <input type="checkbox" th:field="*{facilities}"
									th:value="${option}" />
								<span
									class="text-muted">[[${option.facility_name}]]</span>&nbsp;<b>[[${option.facility_code}]]</b>
							</label>
						</div>
					</div>
				</div>
			</div>

			<hr class="mb-4 bg-secondary">
			<div class="">
				<button class="btn btn-primary btn-lg" type="submit">SUBMIT</button>
				<a class="btn btn-secondary btn-lg" href="#" th:href="@{/controls/users}">CANCEL</a>
			</div>
		</form>
	</div>
</content>

<scripts>
	<script>
		// Example starter JavaScript for disabling form submissions if there are invalid fields
		function onChange() {
			const password = document.querySelector('input[id=user_password]');
			const confirm = document.querySelector('input[id=confirm_password]');
			if (confirm.value === password.value) {
				confirm.setCustomValidity('');
			} else {
				confirm.setCustomValidity('Passwords do not match');
			}
		}

		(function () {
			'use strict';
			window.addEventListener('load', function () {
				// Fetch all the forms we want to apply custom Bootstrap validation styles to
				var forms = document.getElementsByClassName('needs-validation');

				// Loop over them and prevent submission
				var validation = Array.prototype.filter.call(forms, function (form) {
					form.addEventListener('submit', function (event) {
						if (form.checkValidity() === false) {
							event.preventDefault();
							event.stopPropagation();
						}
						form.classList.add('was-validated');

					}, false);
				});
			}, false);
		})();
	</script>
</scripts>

</html>